<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Python parallel processing | Chi</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Python parallel processing" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A blogpost about parallel processing in Python." />
<meta property="og:description" content="A blogpost about parallel processing in Python." />
<link rel="canonical" href="https://blog.codescv.com/python/programming/python-parallel-processing.html" />
<meta property="og:url" content="https://blog.codescv.com/python/programming/python-parallel-processing.html" />
<meta property="og:site_name" content="Chi" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-30T00:00:00-05:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.codescv.com/python/programming/python-parallel-processing.html"},"description":"A blogpost about parallel processing in Python.","@type":"BlogPosting","url":"https://blog.codescv.com/python/programming/python-parallel-processing.html","headline":"Python parallel processing","dateModified":"2020-08-30T00:00:00-05:00","datePublished":"2020-08-30T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://blog.codescv.com/feed.xml" title="Chi" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Python parallel processing | Chi</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Python parallel processing" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A blogpost about parallel processing in Python." />
<meta property="og:description" content="A blogpost about parallel processing in Python." />
<link rel="canonical" href="https://blog.codescv.com/python/programming/python-parallel-processing.html" />
<meta property="og:url" content="https://blog.codescv.com/python/programming/python-parallel-processing.html" />
<meta property="og:site_name" content="Chi" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-30T00:00:00-05:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.codescv.com/python/programming/python-parallel-processing.html"},"description":"A blogpost about parallel processing in Python.","@type":"BlogPosting","url":"https://blog.codescv.com/python/programming/python-parallel-processing.html","headline":"Python parallel processing","dateModified":"2020-08-30T00:00:00-05:00","datePublished":"2020-08-30T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://blog.codescv.com/feed.xml" title="Chi" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Chi</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Python parallel processing</h1><p class="page-description">A blogpost about parallel processing in Python.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-08-30T00:00:00-05:00" itemprop="datePublished">
        Aug 30, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      7 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#Python">Python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#Programming">Programming</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/codescv/blog/tree/master/_notebooks/2020-08-30-python-parallel-processing.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/codescv/blog/master?filepath=_notebooks%2F2020-08-30-python-parallel-processing.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/codescv/blog/blob/master/_notebooks/2020-08-30-python-parallel-processing.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#A-Simple-Example">A Simple Example </a></li>
<li class="toc-entry toc-h1"><a href="#Dig-into-the-Implementation">Dig into the Implementation </a></li>
<li class="toc-entry toc-h1"><a href="#Use-cases">Use cases </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-08-30-python-parallel-processing.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I came across this function called <code>parallel</code> in <a href="https://github.com/fastai/fastai">fastai</a>, and it seems very interesting.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="A-Simple-Example">
<a class="anchor" href="#A-Simple-Example" aria-hidden="true"><span class="octicon octicon-link"></span></a>A Simple Example<a class="anchor-link" href="#A-Simple-Example"> </a>
</h1>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install fastai nbdev
<span class="kn">from</span> <span class="nn">nbdev.showdoc</span> <span class="kn">import</span> <span class="n">doc</span>
<span class="kn">from</span> <span class="nn">fastcore.all</span> <span class="kn">import</span> <span class="n">parallel</span>
<span class="n">doc</span><span class="p">(</span><span class="n">parallel</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-yellow-fg">WARNING: The directory '/github/home/.cache/pip' or its parent directory is not owned or is not writable by the current user. The cache has been disabled. Check the permissions and owner of that directory. If executing pip with sudo, you may want sudo's -H flag.</span>
Collecting fastai
  Downloading fastai-2.0.6-py3-none-any.whl (353 kB)
     |████████████████████████████████| 353 kB 4.6 MB/s 
Requirement already satisfied: nbdev in /usr/local/lib/python3.7/site-packages (0.2.18)
Requirement already satisfied: pip in /usr/local/lib/python3.7/site-packages (from fastai) (20.2.2)
Collecting torchvision&gt;=0.7
  Downloading torchvision-0.7.0-cp37-cp37m-manylinux1_x86_64.whl (5.9 MB)
     |████████████████████████████████| 5.9 MB 8.3 MB/s 
Collecting matplotlib
  Downloading matplotlib-3.3.1-cp37-cp37m-manylinux1_x86_64.whl (11.6 MB)
     |████████████████████████████████| 11.6 MB 60.8 MB/s 
Collecting pillow
  Downloading Pillow-7.2.0-cp37-cp37m-manylinux1_x86_64.whl (2.2 MB)
     |████████████████████████████████| 2.2 MB 58.8 MB/s 
Collecting scikit-learn
  Downloading scikit_learn-0.23.2-cp37-cp37m-manylinux1_x86_64.whl (6.8 MB)
     |████████████████████████████████| 6.8 MB 36.8 MB/s 
Collecting torch&gt;=1.6.0
  Downloading torch-1.6.0-cp37-cp37m-manylinux1_x86_64.whl (748.8 MB)
     |████████████████████████████████| 748.8 MB 74.8 MB/s 
Collecting fastprogress&gt;=0.2.4
  Downloading fastprogress-1.0.0-py3-none-any.whl (12 kB)
Requirement already satisfied: packaging in /usr/local/lib/python3.7/site-packages (from fastai) (20.4)
Collecting requests
  Downloading requests-2.24.0-py2.py3-none-any.whl (61 kB)
     |████████████████████████████████| 61 kB 17.8 MB/s 
Requirement already satisfied: pyyaml in /usr/local/lib/python3.7/site-packages (from fastai) (5.3.1)
Collecting spacy
  Downloading spacy-2.3.2-cp37-cp37m-manylinux1_x86_64.whl (9.9 MB)
     |████████████████████████████████| 9.9 MB 19.3 MB/s 
Collecting pandas&gt;=1.1.0
  Downloading pandas-1.1.1-cp37-cp37m-manylinux1_x86_64.whl (10.5 MB)
     |████████████████████████████████| 10.5 MB 62.7 MB/s 
Collecting fastcore&gt;=1.0.0
  Downloading fastcore-1.0.0-py3-none-any.whl (36 kB)
Collecting scipy
  Downloading scipy-1.5.2-cp37-cp37m-manylinux1_x86_64.whl (25.9 MB)
     |████████████████████████████████| 25.9 MB 19.7 MB/s 
Requirement already satisfied: fastscript in /usr/local/lib/python3.7/site-packages (from nbdev) (1.0.0)
Requirement already satisfied: nbformat&gt;=4.4.0 in /usr/local/lib/python3.7/site-packages (from nbdev) (5.0.7)
Requirement already satisfied: nbconvert&gt;=5.6.1 in /usr/local/lib/python3.7/site-packages (from nbdev) (5.6.1)
Collecting numpy
  Downloading numpy-1.19.1-cp37-cp37m-manylinux2010_x86_64.whl (14.5 MB)
     |████████████████████████████████| 14.5 MB 51.2 MB/s 
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.3 in /usr/local/lib/python3.7/site-packages (from matplotlib-&gt;fastai) (2.4.7)
Collecting certifi&gt;=2020.06.20
  Downloading certifi-2020.6.20-py2.py3-none-any.whl (156 kB)
     |████████████████████████████████| 156 kB 63.2 MB/s 
Requirement already satisfied: python-dateutil&gt;=2.1 in /usr/local/lib/python3.7/site-packages (from matplotlib-&gt;fastai) (2.8.1)
Collecting cycler&gt;=0.10
  Downloading cycler-0.10.0-py2.py3-none-any.whl (6.5 kB)
Collecting kiwisolver&gt;=1.0.1
  Downloading kiwisolver-1.2.0-cp37-cp37m-manylinux1_x86_64.whl (88 kB)
     |████████████████████████████████| 88 kB 54.4 MB/s 
Collecting joblib&gt;=0.11
  Downloading joblib-0.16.0-py3-none-any.whl (300 kB)
     |████████████████████████████████| 300 kB 58.3 MB/s 
Collecting threadpoolctl&gt;=2.0.0
  Downloading threadpoolctl-2.1.0-py3-none-any.whl (12 kB)
Collecting future
  Downloading future-0.18.2.tar.gz (829 kB)
     |████████████████████████████████| 829 kB 39.9 MB/s 
Requirement already satisfied: six in /usr/local/lib/python3.7/site-packages (from packaging-&gt;fastai) (1.15.0)
Collecting idna&lt;3,&gt;=2.5
  Downloading idna-2.10-py2.py3-none-any.whl (58 kB)
     |████████████████████████████████| 58 kB 51.3 MB/s 
Collecting urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1
  Downloading urllib3-1.25.10-py2.py3-none-any.whl (127 kB)
     |████████████████████████████████| 127 kB 66.5 MB/s 
Collecting chardet&lt;4,&gt;=3.0.2
  Downloading chardet-3.0.4-py2.py3-none-any.whl (133 kB)
     |████████████████████████████████| 133 kB 67.8 MB/s 
Collecting cymem&lt;2.1.0,&gt;=2.0.2
  Downloading cymem-2.0.3-cp37-cp37m-manylinux1_x86_64.whl (32 kB)
Collecting preshed&lt;3.1.0,&gt;=3.0.2
  Downloading preshed-3.0.2-cp37-cp37m-manylinux1_x86_64.whl (118 kB)
     |████████████████████████████████| 118 kB 68.3 MB/s 
Collecting srsly&lt;1.1.0,&gt;=1.0.2
  Downloading srsly-1.0.2-cp37-cp37m-manylinux1_x86_64.whl (185 kB)
     |████████████████████████████████| 185 kB 62.4 MB/s 
Collecting murmurhash&lt;1.1.0,&gt;=0.28.0
  Downloading murmurhash-1.0.2-cp37-cp37m-manylinux1_x86_64.whl (19 kB)
Collecting wasabi&lt;1.1.0,&gt;=0.4.0
  Downloading wasabi-0.8.0-py3-none-any.whl (23 kB)
Collecting tqdm&lt;5.0.0,&gt;=4.38.0
  Downloading tqdm-4.48.2-py2.py3-none-any.whl (68 kB)
     |████████████████████████████████| 68 kB 52.2 MB/s 
Requirement already satisfied: setuptools in /usr/local/lib/python3.7/site-packages (from spacy-&gt;fastai) (41.2.0)
Collecting blis&lt;0.5.0,&gt;=0.4.0
  Downloading blis-0.4.1-cp37-cp37m-manylinux1_x86_64.whl (3.7 MB)
     |████████████████████████████████| 3.7 MB 61.1 MB/s 
Collecting plac&lt;1.2.0,&gt;=0.9.6
  Downloading plac-1.1.3-py2.py3-none-any.whl (20 kB)
Collecting thinc==7.4.1
  Downloading thinc-7.4.1-cp37-cp37m-manylinux1_x86_64.whl (2.1 MB)
     |████████████████████████████████| 2.1 MB 61.5 MB/s 
Collecting catalogue&lt;1.1.0,&gt;=0.0.7
  Downloading catalogue-1.0.0-py2.py3-none-any.whl (7.7 kB)
Collecting pytz&gt;=2017.2
  Downloading pytz-2020.1-py2.py3-none-any.whl (510 kB)
     |████████████████████████████████| 510 kB 60.0 MB/s 
Collecting dataclasses
  Downloading dataclasses-0.6-py3-none-any.whl (14 kB)
Requirement already satisfied: wheel in /usr/local/lib/python3.7/site-packages (from fastcore&gt;=1.0.0-&gt;fastai) (0.33.6)
Requirement already satisfied: jupyter-core in /usr/local/lib/python3.7/site-packages (from nbformat&gt;=4.4.0-&gt;nbdev) (4.6.3)
Requirement already satisfied: traitlets&gt;=4.1 in /usr/local/lib/python3.7/site-packages (from nbformat&gt;=4.4.0-&gt;nbdev) (4.3.3)
Requirement already satisfied: jsonschema!=2.5.0,&gt;=2.4 in /usr/local/lib/python3.7/site-packages (from nbformat&gt;=4.4.0-&gt;nbdev) (3.2.0)
Requirement already satisfied: ipython-genutils in /usr/local/lib/python3.7/site-packages (from nbformat&gt;=4.4.0-&gt;nbdev) (0.2.0)
Requirement already satisfied: pygments in /usr/local/lib/python3.7/site-packages (from nbconvert&gt;=5.6.1-&gt;nbdev) (2.6.1)
Requirement already satisfied: jinja2&gt;=2.4 in /usr/local/lib/python3.7/site-packages (from nbconvert&gt;=5.6.1-&gt;nbdev) (2.11.2)
Requirement already satisfied: pandocfilters&gt;=1.4.1 in /usr/local/lib/python3.7/site-packages (from nbconvert&gt;=5.6.1-&gt;nbdev) (1.4.2)
Requirement already satisfied: defusedxml in /usr/local/lib/python3.7/site-packages (from nbconvert&gt;=5.6.1-&gt;nbdev) (0.6.0)
Requirement already satisfied: mistune&lt;2,&gt;=0.8.1 in /usr/local/lib/python3.7/site-packages (from nbconvert&gt;=5.6.1-&gt;nbdev) (0.8.4)
Requirement already satisfied: bleach in /usr/local/lib/python3.7/site-packages (from nbconvert&gt;=5.6.1-&gt;nbdev) (3.1.5)
Requirement already satisfied: entrypoints&gt;=0.2.2 in /usr/local/lib/python3.7/site-packages (from nbconvert&gt;=5.6.1-&gt;nbdev) (0.3)
Requirement already satisfied: testpath in /usr/local/lib/python3.7/site-packages (from nbconvert&gt;=5.6.1-&gt;nbdev) (0.4.4)
Requirement already satisfied: importlib-metadata&gt;=0.20; python_version &lt; "3.8" in /usr/local/lib/python3.7/site-packages (from catalogue&lt;1.1.0,&gt;=0.0.7-&gt;spacy-&gt;fastai) (1.7.0)
Requirement already satisfied: decorator in /usr/local/lib/python3.7/site-packages (from traitlets&gt;=4.1-&gt;nbformat&gt;=4.4.0-&gt;nbdev) (4.4.2)
Requirement already satisfied: pyrsistent&gt;=0.14.0 in /usr/local/lib/python3.7/site-packages (from jsonschema!=2.5.0,&gt;=2.4-&gt;nbformat&gt;=4.4.0-&gt;nbdev) (0.16.0)
Requirement already satisfied: attrs&gt;=17.4.0 in /usr/local/lib/python3.7/site-packages (from jsonschema!=2.5.0,&gt;=2.4-&gt;nbformat&gt;=4.4.0-&gt;nbdev) (20.1.0)
Requirement already satisfied: MarkupSafe&gt;=0.23 in /usr/local/lib/python3.7/site-packages (from jinja2&gt;=2.4-&gt;nbconvert&gt;=5.6.1-&gt;nbdev) (1.1.1)
Requirement already satisfied: webencodings in /usr/local/lib/python3.7/site-packages (from bleach-&gt;nbconvert&gt;=5.6.1-&gt;nbdev) (0.5.1)
Requirement already satisfied: zipp&gt;=0.5 in /usr/local/lib/python3.7/site-packages (from importlib-metadata&gt;=0.20; python_version &lt; "3.8"-&gt;catalogue&lt;1.1.0,&gt;=0.0.7-&gt;spacy-&gt;fastai) (3.1.0)
Building wheels for collected packages: future
  Building wheel for future (setup.py) ... - \ | done
  Created wheel for future: filename=future-0.18.2-py3-none-any.whl size=491056 sha256=dfb3fc061cbcd3cc706509ed99c49c546f724bcb7915675942c2a28b79dfb320
  Stored in directory: /tmp/pip-ephem-wheel-cache-ljtswj9i/wheels/56/b0/fe/4410d17b32f1f0c3cf54cdfb2bc04d7b4b8f4ae377e2229ba0
Successfully built future
Installing collected packages: pillow, numpy, future, torch, torchvision, certifi, cycler, kiwisolver, matplotlib, joblib, scipy, threadpoolctl, scikit-learn, fastprogress, idna, urllib3, chardet, requests, cymem, murmurhash, preshed, srsly, wasabi, tqdm, blis, plac, catalogue, thinc, spacy, pytz, pandas, dataclasses, fastcore, fastai
Successfully installed blis-0.4.1 catalogue-1.0.0 certifi-2020.6.20 chardet-3.0.4 cycler-0.10.0 cymem-2.0.3 dataclasses-0.6 fastai-2.0.6 fastcore-1.0.0 fastprogress-1.0.0 future-0.18.2 idna-2.10 joblib-0.16.0 kiwisolver-1.2.0 matplotlib-3.3.1 murmurhash-1.0.2 numpy-1.19.1 pandas-1.1.1 pillow-7.2.0 plac-1.1.3 preshed-3.0.2 pytz-2020.1 requests-2.24.0 scikit-learn-0.23.2 scipy-1.5.2 spacy-2.3.2 srsly-1.0.2 thinc-7.4.1 threadpoolctl-2.1.0 torch-1.6.0 torchvision-0.7.0 tqdm-4.48.2 urllib3-1.25.10 wasabi-0.8.0
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As the documentation states, the <code>parallel</code> function can run any python function <code>f</code> with <code>items</code> using multiple workers, and collect the results.</p>
<p>Let's try a simple examples:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>

<span class="n">numbers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">numbers</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 10 s
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="nb">list</span><span class="p">(</span><span class="n">parallel</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">numbers</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CPU times: user 32 ms, sys: 52 ms, total: 84 ms
Wall time: 2.08 s
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The function <code>f</code> we have in this example is very simple: it sleeps for one second and then returns <code>x*2</code>. When executed in serial, it takes 10 seconds which is exactly
what we expect. When using more workers(8 by default), it takes only 2 seconds.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Dig-into-the-Implementation">
<a class="anchor" href="#Dig-into-the-Implementation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dig into the Implementation<a class="anchor-link" href="#Dig-into-the-Implementation"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's see how <code>parallel</code> is implemented:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>parallel<span class="o">??</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea ">
<pre><span class="ansi-red-fg">Signature:</span>
parallel<span class="ansi-blue-fg">(</span>
    f<span class="ansi-blue-fg">,</span>
    items<span class="ansi-blue-fg">,</span>
    <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span>
    n_workers<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">8</span><span class="ansi-blue-fg">,</span>
    total<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span>
    progress<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span>
    pause<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span>
    <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Source:</span>   
<span class="ansi-green-fg">def</span> parallel<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> items<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> n_workers<span class="ansi-blue-fg">=</span>defaults<span class="ansi-blue-fg">.</span>cpus<span class="ansi-blue-fg">,</span> total<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> progress<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> pause<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
    <span class="ansi-blue-fg">"Applies `func` in parallel to `items`, using `n_workers`"</span>
    <span class="ansi-green-fg">if</span> progress <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> progress <span class="ansi-blue-fg">=</span> progress_bar <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span>
    <span class="ansi-green-fg">with</span> ProcessPoolExecutor<span class="ansi-blue-fg">(</span>n_workers<span class="ansi-blue-fg">,</span> pause<span class="ansi-blue-fg">=</span>pause<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> ex<span class="ansi-blue-fg">:</span>
        r <span class="ansi-blue-fg">=</span> ex<span class="ansi-blue-fg">.</span>map<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span>items<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
        <span class="ansi-green-fg">if</span> progress<span class="ansi-blue-fg">:</span>
            <span class="ansi-green-fg">if</span> total <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> total <span class="ansi-blue-fg">=</span> len<span class="ansi-blue-fg">(</span>items<span class="ansi-blue-fg">)</span>
            r <span class="ansi-blue-fg">=</span> progress_bar<span class="ansi-blue-fg">(</span>r<span class="ansi-blue-fg">,</span> total<span class="ansi-blue-fg">=</span>total<span class="ansi-blue-fg">,</span> leave<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span>
        <span class="ansi-green-fg">return</span> L<span class="ansi-blue-fg">(</span>r<span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">File:</span>      /opt/conda/lib/python3.7/site-packages/fastcore/utils.py
<span class="ansi-red-fg">Type:</span>      function
</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">??</span>ProcessPoolExecutor
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea ">
<pre><span class="ansi-red-fg">Init signature:</span>
ProcessPoolExecutor<span class="ansi-blue-fg">(</span>
    max_workers<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">8</span><span class="ansi-blue-fg">,</span>
    on_exc<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&lt;</span>built<span class="ansi-blue-fg">-</span><span class="ansi-green-fg">in</span> function print<span class="ansi-blue-fg">&gt;</span><span class="ansi-blue-fg">,</span>
    pause<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span>
    mp_context<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span>
    initializer<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span>
    initargs<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">Source:</span>        
<span class="ansi-green-fg">class</span> ProcessPoolExecutor<span class="ansi-blue-fg">(</span>concurrent<span class="ansi-blue-fg">.</span>futures<span class="ansi-blue-fg">.</span>ProcessPoolExecutor<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
    <span class="ansi-blue-fg">"Same as Python's ProcessPoolExecutor, except can pass `max_workers==0` for serial execution"</span>
    <span class="ansi-green-fg">def</span> __init__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> max_workers<span class="ansi-blue-fg">=</span>defaults<span class="ansi-blue-fg">.</span>cpus<span class="ansi-blue-fg">,</span> on_exc<span class="ansi-blue-fg">=</span>print<span class="ansi-blue-fg">,</span> pause<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
        <span class="ansi-green-fg">if</span> max_workers <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> max_workers<span class="ansi-blue-fg">=</span>defaults<span class="ansi-blue-fg">.</span>cpus
        self<span class="ansi-blue-fg">.</span>not_parallel <span class="ansi-blue-fg">=</span> max_workers<span class="ansi-blue-fg">==</span><span class="ansi-cyan-fg">0</span>
        store_attr<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">'on_exc,pause,max_workers'</span><span class="ansi-blue-fg">)</span>
        <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>not_parallel<span class="ansi-blue-fg">:</span> max_workers<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">1</span>
        super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__init__<span class="ansi-blue-fg">(</span>max_workers<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>

    <span class="ansi-green-fg">def</span> map<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">,</span> items<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
        self<span class="ansi-blue-fg">.</span>lock <span class="ansi-blue-fg">=</span> Manager<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>Lock<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
        g <span class="ansi-blue-fg">=</span> partial<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
        <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>not_parallel<span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> map<span class="ansi-blue-fg">(</span>g<span class="ansi-blue-fg">,</span> items<span class="ansi-blue-fg">)</span>
        <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>map<span class="ansi-blue-fg">(</span>partial<span class="ansi-blue-fg">(</span>_call<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>lock<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>pause<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>max_workers<span class="ansi-blue-fg">,</span> g<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> items<span class="ansi-blue-fg">)</span>
        <span class="ansi-green-fg">except</span> Exception <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span> self<span class="ansi-blue-fg">.</span>on_exc<span class="ansi-blue-fg">(</span>e<span class="ansi-blue-fg">)</span>
<span class="ansi-red-fg">File:</span>           /opt/conda/lib/python3.7/site-packages/fastcore/utils.py
<span class="ansi-red-fg">Type:</span>           type
<span class="ansi-red-fg">Subclasses:</span>     
</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As we can see in the source code, under the hood, this is using the <a href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor">concurrent.futures.ProcessPoolExecutor</a> class from Python.</p>
<p>Note that this class is essentially different than Python Threads, which is subject to the Global Interpreter Lock.</p>
<p>The ProcessPoolExecutor class is an Executor subclass that uses a pool of processes to execute calls asynchronously. ProcessPoolExecutor uses the multiprocessing module, which allows it to side-step the Global Interpreter Lock but also means that only picklable objects can be executed and returned.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Use-cases">
<a class="anchor" href="#Use-cases" aria-hidden="true"><span class="octicon octicon-link"></span></a>Use cases<a class="anchor-link" href="#Use-cases"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This function can be quite useful for long running tasks and you want to take advantage of multi-core CPUs to speed up your processing. For example, if you want to download a lot of images from the internet, you may want to use this to parallize your download jobs.</p>
<p>If your function <code>f</code> is very fast, there can be suprising cases, here is an example:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>

<span class="n">numbers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">numbers</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CPU times: user 0 ns, sys: 0 ns, total: 0 ns
Wall time: 1.24 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>

<span class="nb">list</span><span class="p">(</span><span class="n">parallel</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">numbers</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
CPU times: user 3.96 s, sys: 940 ms, total: 4.9 s
Wall time: 12.4 s
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the above example, <code>f</code> is very fast and the overhead of creating a lot of tasks outweigh the advantage of multi-processing. So use this with caution, and always take profiles.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="codescv/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/python/programming/python-parallel-processing.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Chi&#39;s blog about ML, NLP, Programming and others.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/codescv" title="codescv"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/codescv" title="codescv"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
